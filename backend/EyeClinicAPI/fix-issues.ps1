# ?? ??????? ????????
Write-Host "=== ?? ????? EyeClinic API ===" -ForegroundColor Cyan

# 1. ?????? ?? ????? ???????? ???????
Write-Host "`n[1] ????? ?????? API ???????..." -ForegroundColor Yellow
Get-Process -Name "EyeClinicAPI" -ErrorAction SilentlyContinue | Stop-Process -Force
Start-Sleep -Seconds 2

# 2. ???????? ????? API
$apiPath = Join-Path $PSScriptRoot "EyeClinicAPI"
if (-not (Test-Path $apiPath)) {
    Write-Host "???: ???? EyeClinicAPI ??? ?????!" -ForegroundColor Red
    exit
}
Set-Location $apiPath

# 3. ????? ????? HTTPS
Write-Host "`n[2] ????? ????? HTTPS..." -ForegroundColor Yellow
dotnet dev-certs https --clean | Out-Null
dotnet dev-certs https --trust

# 4. ??????? packages
Write-Host "`n[3] ??????? NuGet packages..." -ForegroundColor Yellow
dotnet restore

# 5. ???? ???????
Write-Host "`n[4] ???? ???????..." -ForegroundColor Yellow
dotnet build --no-restore

# 6. ????? migrations
Write-Host "`n[5] ????? ????? ????????..." -ForegroundColor Yellow
try {
    dotnet ef database update
    Write-Host "? ????? ???????? ????? ?????" -ForegroundColor Green
} catch {
    Write-Host "?? ?????: ?? ????? ?????? EF tools" -ForegroundColor Yellow
    Write-Host "???: dotnet tool install --global dotnet-ef" -ForegroundColor Yellow
}

# 7. ?????? ?? ???? Doctors
Write-Host "`n[6] ?????? ?? ???????? ????????..." -ForegroundColor Yellow
Write-Host "???? ?? ????? Doctor ???? ??? ????? ??? ??????? ???????" -ForegroundColor Cyan
Write-Host "????? ????? Doctor ?? Swagger: https://localhost:7071/swagger" -ForegroundColor Cyan

# 8. ??? ????????? ????????
Write-Host "`n=== ???? ??????? ===" -ForegroundColor Green
Write-Host "`n?????? API:" -ForegroundColor White
Write-Host "  cd EyeClinicAPI" -ForegroundColor Gray
Write-Host "  dotnet run --launch-profile https" -ForegroundColor Gray
Write-Host "`n?????? Frontend:" -ForegroundColor White
Write-Host "  cd frontend" -ForegroundColor Gray
Write-Host "  npm run dev" -ForegroundColor Gray
Write-Host "`nSwagger: https://localhost:7071/swagger" -ForegroundColor Cyan
Write-Host "Frontend: http://localhost:5173" -ForegroundColor Cyan

Write-Host "`n? ??? ?????? ??????? ?????!" -ForegroundColor Green
Write-Host "???? ??? TROUBLESHOOTING.md ?????? ?? ????????" -ForegroundColor Yellow
