import React, { useEffect, useState } from 'react'

const API_BASE = import.meta.env.VITE_API_BASE || 'https://localhost:7071'

export default function Dashboard(){
  const [stats, setStats] = useState(null)
  const [today, setToday] = useState([])

  useEffect(()=>{
    fetchStats()
    fetchToday()
  },[])

  async function fetchStats(){
    try{
      const res = await fetch(`${API_BASE}/api/Dashboard/Stats`)
      if(res.ok) setStats(await res.json())
    }catch(e){
      console.error(e)
    }
  }

  async function fetchToday(){
    try{
      const res = await fetch(`${API_BASE}/api/Dashboard/Today`)
      if(res.ok) setToday(await res.json())
    }catch(e){
      console.error(e)
    }
  }

  return (
    <div>
      <h2>Dashboard</h2>
      {stats ? (
        <div style={{display:'flex', gap:12}}>
          <div>Total: {stats.TotalAppointments}</div>
          <div>Completed: {stats.CompletedAppointments}</div>
          <div>Today: {stats.TodayAppointments}</div>
          <div>Upcoming: {stats.UpcomingAppointments}</div>
          <div>Cancelled: {stats.CancelledAppointments}</div>
        </div>
      ) : <div>Loading stats...</div>}

      <h3>Today's Appointments</h3>
      <ul>
        {today.length ? today.map((a, idx)=> <li key={idx}>{a.Time} - {a.PatientName} ({a.PatientId}) - {a.Status} - {a.Doctor}</li>) : <li>No appointments today</li>}
      </ul>
    </div>
  )
}
